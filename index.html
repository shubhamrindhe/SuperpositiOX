<!DOCTYPE html>
<html>
    <head>
        <title>TitanToe</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
		<meta name="author" content="shubhamrindhe" id="author"/>
        <style>
		body,*{
			background:none;
			margin:0;
			padding:0;
		}
		table{
			margin:0;
			/*border-collapse:collapse;*/
		}
		tr{
			margin:0;
			padding:0;
		}
		td{
			width:100px;
			height:100px;
			
			display:flex-box;
			justify-content:center;
			align-items:center;
			text-align:center;
			
			cursor:pointer;
		}
		td > svg{
			padding:0 0;
			margin:0 0 ;
		}
		td > svg:not (:root ) {
			width:100%;
			height: auto;
		}
		.grid{
			display:flex;
			justify-content:center;
			align-items:center;
			height:100vh;
		}
		.v{
			border-left:2px solid black;
			border-right:2px solid black;
		}
		.h{
			border-top:2px solid black;
			border-bottom:2px solid black;
		}
		.l{
			border-left:2px solid black;
		}
		.r{
			border-right:2px solid black;
		}
		.t{
			border-top:2px solid black;
		}
		.b{
			border-bottom:2px solid black;
		}
		
		
		
		@media only screen and (max-width: 700px) {
			td{
				width:80px;
				height:80px;
				
				display:flex-box;
				justify-content:center;
				align-items:center;
				text-align:center;
				
				cursor:pointer;
			}
			
			td > svg{
				width:70px;
				height:70px;
				transform:scale(0.7,0.7);
				padding:0 0;
				margin:0 0 ;
			}
			
			
			td > svg:not (:root ) {
				width:100%;
				height: auto;
			}
		}
		
        </style>
    </head>
    <body>
	
		<div class="grid">
			<table>
				<tr>
					<td id="0" class=""></td>
					<td id="1" class="v"></td> 
					<td id="2" class=""></td>
				</tr>
				<tr>
					<td id="3" class="h"></td>
					<td id="4" class="h v"></td>
					<td id="5" class="h"></td>
				</tr>
				<tr>
					<td id="6" class=""></td>
					<td id="7" class="v"></td>
					<td id="8" class=""></td>
				</tr>
			</table>
		</div>
		
    </body>
	
	
	<script>
	
	var X = '<svg width="80" height="80">\
			<line x1="20" y1="20" x2="60" y2="60" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>\
			<line x1="20" y1="60" x2="60" y2="20" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>\
			</svg>';
			
	var O = '<svg width="80" height="80">\
			<circle cx="40" cy="40" r="25" stroke="red" fill="none" stroke-width="5" />\
			</svg>';
			
	var hooman = 'X';
	var computer = 'O';
	
	var winning_combos = [
		[0,1,2],
		[3,4,5],
		[6,7,8],
		
		[0,3,6],
		[1,4,7],
		[2,5,8],
		
		[0,4,8],
		[2,4,6]
	];
	
	
	var turn = true;
	
	var size = 9;
	var DOM_grid = Array(size);
	var grid = Array.from(Array(9).keys());
	var turn = true;
	
	window.onload = function(){
		init();
		addListeners();
	}
	
	function init(){
		for(var i=0;i<size;++i){
			DOM_grid[i] = document.getElementById(i);
		}
	}
	
	function reset(){
		for(var i=0;i<size;++i){
			DOM_grid[i].innerHTML = '';
		}
		grid = Array.from(Array(9).keys());
	}
	
	function addListeners(){
		for(var i=0;i<size;++i){
			DOM_grid[i].setAttribute('onclick','handleTurn(event,this)');
		}
	}
	
	function destroy(){
		for(var i=0;i<size;++i){
			DOM_grid[i].setAttribute('onclick','handleTurn(event,this)');
		}
	}
	
	function handleTurn(e,DOM){
		if(turn && DOM.innerHTML==''){
			turn = false;
			var id =  DOM.id;
			mark(id,hooman);
			
			//DOM.innerHTML = turn?O:X;
			//grid[DOM.id] = hooman;
			
			var end = checkWin(grid,hooman);
			if(end == null){
				if(!checkTie()){
					var spot = bestSpot();
					console.log(spot);
					mark(spot,'O');
					
					end = checkWin(grid,computer);
					
					if(end == null){
					
					
					
					}else{
						endgame(end.player,end.index);
						turn = false;
					}
					
				}else{
					endgame('-',null);
				}
				turn = true;
			}else{
				endgame(end.player,end.index);
				turn = false;
			}
			
			
		}	
		
	}
	
	function mark(id,player){
		DOM_grid[id].innerHTML = (player=='O'?O:X);
		grid[id] = player;
	}
	
	function bestSpot(){
		return minimax(grid,computer).index;
	}
	
	function emptyCells(list){
		return list.filter( s => typeof s == 'number' );
	}
	
	function checkTie(){
		if(emptyCells(grid).length==0)
			return true;
		else
			return false;
			
	}
	
	function checkWin(board,player){
		let plays = board.reduce( (a,e,i) => ( (e === player) ? a.concat(i) : a ) , [] );
			
		let gamewin = null;
		
		for(let [index,combo] of winning_combos.entries()){
			if( combo.every(elem=>plays.indexOf(elem)>-1) ){
				gamewin = {
					index : index,
					player : player
				};
				break;
			}	
		}
		return gamewin;
	}
	
	
	function minimax(board,player,alpha=-Infinity,beta=Infinity){
		var avail_spots = emptyCells(board);
		
		if(checkWin(board,hooman))
			return {score:-1};
		if(checkWin(board,computer))
			return {score:1};
		if(avail_spots.length==0)
			return {score:0};	
			
		var moves = [];

		for(var i=0;i<avail_spots.length;++i){
		
			var move = {};
			move.index = board[avail_spots[i]];
			board[avail_spots[i]] = player;
			if(player==computer){
				var result = minimax(board,hooman,alpha,beta);
				move.score = result.score;
				
				/*
				var best_val = Math.min()
				var best_val = Math.min(alpha)
				*/
				
			}else{
				var result = minimax(board,computer,alpha,beta);
				move.score = result.score;
			}
			board[avail_spots[i]] = move.index;
			moves.push(move);
			
			
		}
		var bestmove;
		
		if(player==computer){
			var bestscore = -Infinity;
			for(var i=0;i<moves.length;++i){
				if(moves[i].score > bestscore){
					bestscore = moves[i].score;
					bestmove = i;
				}
			}
		}else{
			var bestscore = Infinity;
			for(var i=0;i<moves.length;++i){
				if(moves[i].score < bestscore){
					bestscore = moves[i].score;
					bestmove = i;
				}
			}
		
		}
		return moves[bestmove];
	}
	
	function endgame(player,combo){
		if(player == computer){
			alert("You Lost!");
		}else if(player == hooman){
			alert("You Won!");
		}else{
			alert("It's A Draw!");
		}
		if(combo!=null)
			for(var i=0;i<winning_combos[combo].length;++i){
				//DOM_grid[winning_combos[combo][i]].style.background = 'red';
				DOM_grid[winning_combos[combo][i]].style.background = 'linear-gradient(0deg,#6dd1ff,#20b7ff)';
				//DOM_grid[winning_combos[combo][i]].style.boxShadow='0 0 0 2px #353535, 0 0 0 2px #3e3e3e, inset 0 0 2px rgba(0,0,0,1),0 2px 2px rgba(0,0,0,.5),inset 0 0 2px rgba(0,0,0,.2)';
			}
	}

	</script>
</html>