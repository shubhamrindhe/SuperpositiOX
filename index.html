<!DOCTYPE html>
<html>
    <head>
        <title>TitanToe</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<meta name="author" content="shubhamrindhe" id="author"/>
        <style>
		body,*{
			background:none;
			margin:0;
			padding:0;
			overflow:hidden;
		}
		table{
			margin:0;
			/*
			width:300px;
			height:300px;
			border-collapse:collapse;*/
		}
		tr{
			margin:0;
			padding:0;
		}
		td{
			width:100px;
			height:100px;
			
			
			display:flex-box;
			justify-content:center;
			align-items:center;
			text-align:center;
			
			
			cursor:pointer;
		
		}
		td > svg{
			padding:0 0;
			margin:0 0 ;
			
			animation: zoom-in 0.1s linear;
		}
		td > svg:not (:root ) {
			width:100%;
			height: auto;
		}
		.grid{
			display:flex;
			justify-content:center;
			align-items:center;
			height:100vh;
		}
		.v{
			border-left:2px solid black;
			border-right:2px solid black;
		}
		.h{
			border-top:2px solid black;
			border-bottom:2px solid black;
		}
		.l{
			border-left:2px solid black;
		}
		.r{
			border-right:2px solid black;
		}
		.t{
			border-top:2px solid black;
		}
		.b{
			border-bottom:2px solid black;
		}
		
		
		.centroid{
			position:absolute;
			left:50%;
			top:50%;
			transform:translate(-50%,-50%);
		}
		
		#winning_move{
			width:300px;
			height:300px;
		}
		
		
		
		
		@media only screen and (max-width: 700px) {
			/*
			table{
				width:250px;
				height:250px;
			}
			*/
			td{
				width:80px;
				height:80px;
				
				display:flex-box;
				justify-content:center;
				align-items:center;
				text-align:center;
				
				cursor:pointer;
			}
			
			#winning_move{
				width:240px;
				height:240px;
			}
			
			td > svg{
				width:70px;
				height:70px;
				transform:scale(0.7,0.7);
				padding:0 0;
				margin:0 0;
			}
			
			
			td > svg:not (:root ) {
				width:100%;
				height: auto;
			}
			
			#endgame{
				width:250px;
				height:250px;
			}
		}
		
		@keyframes zoom-in{
			0%{
				opacity :0; 
				transform:scale(0,0);
				
			}
			100%{
				opacity :1;
				transform:scale(1,1);
				
			}
		}
		
		@keyframes activate{
			0%{
				position:absolute;
				top:-100%;
				left:50%;
				transform:translate(-50%,-50%);
			}
			100%{
				position:absolute;
				top:50%;
				left:50%;
				transform:translate(-50%,-50%);
			}
		}
		
		#endgame{
			position:absolute;
			top:-100%;
			left:50%;
			transform:translate(-50%,-50%);
			width:300px;
			height:300px;
			
			color:#fff;
			display:flex-box;
			justify-content:center;
			align-items:center;
			text-align:center;
			
			padding:20px;
			
			//border:2px solid red;
			background:rgba(0,0,0,0.8);
		}
		
		#endgame.active{
			top:50%;
			left:50%;
			
			
			transform:translate(-50%,-50%);
			
			
			animation: activate 0.5s linear;
			transition:0.5s;
		}
		#endgame.not-active{
			top:-100%;
			left:50%;
			
			
			transform:translate(-50%,-50%);
			border:2px solid red;
			
			animation: activate 0.5s reverse linear;
			transition:0.5s;
		}
		
		
		.pulse{
				animation: animate 0.5s linear infinite;
		}
			
		@keyframes animate{
			0%{
				box-shadow : 0 0 0 0 rgba(255,109,74,1);
			}
			40%{
				box-shadow : 0 0 0 50px rgba(255,109,74,.5);
			}
			80%{
				box-shadow : 0 0 0 50px rgba(255,109,74,.2);
			}
			100%{
				box-shadow : 0 0 0 0 rgba(255,109,74,0);
			}
		}
		
		
		
		
        </style>
    </head>
    <body>
	
		<svg id="winning_move" class="centroid" style="display:none;">
			<line x1="20" y1="20" x2="280" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			<line x1="280" y1="20" x2="20" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			
			<line x1="20" y1="50" x2="280" y2="50" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			<line x1="20" y1="150" x2="280" y2="150" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			<line x1="20" y1="250" x2="280" y2="250" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			
			<line x1="50" y1="20" x2="50" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			<line x1="150" y1="20" x2="150" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
			<line x1="250" y1="20" x2="250" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>
		</svg>
	
		<div class="grid">
			<table id="board" class="">
				<tr>
					<td id="0" class=""  data="0"></td>
					<td id="1" class="v" data="1"></td> 
					<td id="2" class=""  data="2"></td>
				</tr>
				<tr>
					<td id="3" class="h"   data="3"></td>
					<td id="4" class="h v" data="4"></td>
					<td id="5" class="h"   data="5"></td>
				</tr>
				<tr>
					<td id="6" class="" data="6"></td>
					<td id="7" class="v" data="7"></td>
					<td id="8" class="" data="8"></td>
				</tr>
			</table>
		</div>
		
		
		<div id="endgame" class="" onclick="restart()"></div>
		
    </body>
	
	
	<script>
	
	var X = '<svg width="80" height="80" class="">\
			<line x1="20" y1="20" x2="60" y2="60" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>\
			<line x1="20" y1="60" x2="60" y2="20" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>\
			</svg>';
			
	var O = '<svg width="80" height="80" class="">\
			<circle cx="40" cy="40" r="25" stroke="red" fill="none" stroke-width="5" />\
			</svg>';
			
	var hooman = 'X';
	var computer = 'O';
	
	var winning_combos = [
		[0,1,2],
		[3,4,5],
		[6,7,8],
		
		[0,3,6],
		[1,4,7],
		[2,5,8],
		
		[0,4,8],
		[2,4,6]
	];
	
	var wins = [
		{x1:0.1,y1:1/6,x2:0.9,y2:1/6},
		{x1:0.1,y1:3/6,x2:0.9,y2:3/6},
		{x1:0.1,y1:5/6,x2:0.9,y2:5/6},
		
		{x1:1/6,y1:0.1,x2:1/6,y2:0.9},
		{x1:3/6,y1:0.1,x2:3/6,y2:0.9},
		{x1:5/6,y1:0.1,x2:5/6,y2:0.9},
		
		{x1:0.1,y1:0.1,x2:0.9,y2:0.9},
		{x1:0.9,y1:0.1,x2:0.1,y2:0.9}
	];
	
	var win_svg = [
		
		'<line x1="20" y1="50" x2="280" y2="50" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',
		'<line x1="20" y1="150" x2="280" y2="150" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',
		'<line x1="20" y1="250" x2="280" y2="250" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',

		'<line x1="50" y1="20" x2="50" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',
		'<line x1="150" y1="20" x2="150" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',
		'<line x1="250" y1="20" x2="250" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',
	
		
		'<line x1="20" y1="20" x2="280" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>',
		'<line x1="280" y1="20" x2="20" y2="280" style="stroke:blue;stroke-width:5" stroke-linecap="round"/>'
	];
	
	
	
	function svg(i){
		var win = wins[i];
		var w = document.getElementById('winning_move').getBoundingClientRect().width;
	
		return '<line x1="'+(win.x1*w)+'" y1="'+(win.y1*w)+'" x2="'+(win.x2*w)+'" y2="'+(win.y2*w)+'" style="stroke:green;stroke-width:5" stroke-linecap="round"/>';
	}
	
	
	//var turn = true;
	
	var size = 9;
	var DOM_grid = Array(size);
	var grid = Array.from(Array(9).keys());
	var turn = true;
	
	window.onload = function(){
		init();
		addListeners();
	}
	
	function init(){
		for(var i=0;i<size;++i){
			DOM_grid[i] = document.getElementById(i);
		}
	}
	
	function reset(){
		for(var i=0;i<size;++i){
			DOM_grid[i].innerHTML = '';
		}
		grid = Array.from(Array(9).keys());
		
		turn = true;
	}
	
	function addListeners(){
		for(var i=0;i<size;++i){
			DOM_grid[i].setAttribute('onclick','handleTurn(event,this)');
			//DOM_grid[i].setAttribute('onclick','handleTurn(event,'+i+')');
		}
	}
	
	function destroy(){
		for(var i=0;i<size;++i){
			DOM_grid[i].setAttribute('onclick','handleTurn(event,this)');
		}
	}
	
	function handleTurn(e,DOM){
		if(turn && DOM.innerHTML==''){
			turn = false;
			var id =  DOM.id;
			mark(id,hooman);
			
			//DOM.innerHTML = turn?O:X;
			//grid[DOM.id] = hooman;
			
			var end = checkWin(grid,hooman);
			if(end == null){
				if(!checkTie()){
					var spot = bestSpot();
					console.log(spot);
					mark(spot,'O');
					
					end = checkWin(grid,computer);
					
					if(end == null){
					
					
					
					}else{
						endgame(end.player,end.index);
						turn = false;
					}
					
				}else{
					endgame('-',null);
				}
				turn = true;
			}else{
				endgame(end.player,end.index);
				turn = false;
			}
			
			
		}	
		
	}
	
	function mark(id,player){
		console.log(id);
		//if(typeof id != 'number')
			//id = parseInt(id);
	
	
		DOM_grid[id].innerHTML = (player=='O'?O:X);
		grid[id] = player;
	}
	
	function bestSpot(){
		return minimax(grid,computer).index;
	}
	
	function emptyCells(list){
		return list.filter( s => typeof s == 'number' );
	}
	
	function checkTie(){
		if(emptyCells(grid).length==0)
			return true;
		else
			return false;
			
	}
	
	function checkWin(board,player){
		let plays = board.reduce( (a,e,i) => ( (e === player) ? a.concat(i) : a ) , [] );
			
		let gamewin = null;
		
		for(let [index,combo] of winning_combos.entries()){
			if( combo.every(elem=>plays.indexOf(elem)>-1) ){
				gamewin = {
					index : index,
					player : player
				};
				break;
			}	
		}
		return gamewin;
	}
	
	
	function minimax(board,player,alpha=-Infinity,beta=Infinity){
		var avail_spots = emptyCells(board);
		
		if(checkWin(board,hooman))
			return {score:-1};
		if(checkWin(board,computer))
			return {score:1};
		if(avail_spots.length==0)
			return {score:0};	
			
		var moves = [];

		for(var i=0;i<avail_spots.length;++i){
		
			var move = {};
			move.index = board[avail_spots[i]];
			board[avail_spots[i]] = player;
			if(player==computer){
				var result = minimax(board,hooman,alpha,beta);
				move.score = result.score;
				
				/*
				var best_val = Math.min()
				var best_val = Math.min(alpha)
				*/
				
			}else{
				var result = minimax(board,computer,alpha,beta);
				move.score = result.score;
			}
			board[avail_spots[i]] = move.index;
			moves.push(move);
			
			
		}
		var bestmove;
		
		if(player==computer){
			var bestscore = -Infinity;
			for(var i=0;i<moves.length;++i){
				if(moves[i].score > bestscore){
					bestscore = moves[i].score;
					bestmove = i;
				}
			}
		}else{
			var bestscore = Infinity;
			for(var i=0;i<moves.length;++i){
				if(moves[i].score < bestscore){
					bestscore = moves[i].score;
					bestmove = i;
				}
			}
		
		}
		return moves[bestmove];
	}
	
	function endgame(player,combo){
		if(player == computer){
			//alert("You Lost!");
			document.getElementById('endgame').innerHTML = 'You Lost!';
		}else if(player == hooman){
			//alert("You Won!");
			document.getElementById('endgame').innerHTML = 'You Won!';
		}else{
			//alert("It's A Draw!");
			document.getElementById('endgame').innerHTML = 'Its a Draw!';
		}
		
		var rect = document.getElementById('board').getBoundingClientRect();
		
		console.log(rect);
		//document.getElementById('winning_move').width = rect.width;
		//document.getElementById('winning_move').height = rect.height;
		
		//document.getElementById('winning_move').top = rect.top;
		//document.getElementById('winning_move').left = rect.left;
		
		//document.getElementById('winning_move').innerHTML = svg(combo);
		document.getElementById('winning_move').style.display = 'block';
		document.getElementById('winning_move').innerHTML = svg(combo);
		document.getElementById('endgame').className = 'active';
		
		if(combo!=null)
			for(var i=0;i<winning_combos[combo].length;++i){
				//DOM_grid[winning_combos[combo][i]].style.background = 'red';
				//DOM_grid[winning_combos[combo][i]].style.background = 'linear-gradient(0deg,#6dd1ff,#20b7ff)';
				//DOM_grid[winning_combos[combo][i]].style.boxShadow = 'inset 0 0 5px #fff';
				//DOM_grid[winning_combos[combo][i]].className = 'pulse';
				//DOM_grid[winning_combos[combo][i]].style.boxShadow='0 0 0 2px #353535, 0 0 0 2px #3e3e3e, inset 0 0 2px rgba(0,0,0,1),0 2px 2px rgba(0,0,0,.5),inset 0 0 2px rgba(0,0,0,.2)';
			}
	}
	
	function restart(){
		//alert("restart");
		document.getElementById('endgame').className = 'not-active';
		document.getElementById('winning_move').style.display = 'none';
		document.getElementById('winning_move').innerHTML = '';
		reset();
	}

	</script>
</html>